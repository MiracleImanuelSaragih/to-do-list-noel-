<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium To-Do List - Miracle</title>

<style>
:root {
  --primary: #667eea;
  --secondary: #764ba2;
  --danger: #f44336;
  --warning: #ff9800;
  --bg: linear-gradient(135deg,#667eea,#764ba2);
}

.dark-mode {
  --bg: linear-gradient(135deg,#1a1a2e,#16213e);
  background:#121212;
  color:white;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  min-height:100vh;
  padding:20px;
}

.container{max-width:1100px;margin:auto}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:white;
  margin-bottom:20px;
}

.icon-btn{
  background:rgba(255,255,255,.2);
  border:none;
  color:white;
  font-size:20px;
  width:42px;
  height:42px;
  border-radius:50%;
  cursor:pointer;
}

.main-card{
  background:white;
  border-radius:16px;
  padding:25px;
}

.dark-mode .main-card{background:#1f1f2f}

.input-row{
  display:grid;
  grid-template-columns:2fr 1fr 1fr auto;
  gap:10px;
  margin-bottom:15px;
}

input,select{
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

button.btn{
  background:var(--bg);
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  cursor:pointer;
}

.task{
  background:#f5f5f5;
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:10px;
  position:relative;
}

.dark-mode .task{background:#2a2a3d}

.task.overdue::before{
  content:'';
  position:absolute;
  left:0;top:0;bottom:0;
  width:4px;
  background:var(--danger);
}

.task.upcoming::before{
  content:'';
  position:absolute;
  left:0;top:0;bottom:0;
  width:4px;
  background:var(--warning);
}

.task.completed{opacity:.6;text-decoration:line-through}

.actions button{
  background:none;
  border:none;
  cursor:pointer;
  font-size:18px;
}

#countdown{
  margin-bottom:15px;
  padding:10px;
  background:#ffebee;
  color:#b71c1c;
  border-radius:8px;
  font-weight:bold;
  text-align:center;
}
</style>
</head>

<body>
<audio id="alarmSound">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<div class="container">
  <div class="header">
    <h2>ğŸš€ Premium To-Do List</h2>
    <div>
      <button class="icon-btn" onclick="toggleDark()">ğŸŒ™</button>
      <button class="icon-btn" onclick="requestNotif()">ğŸ””</button>
    </div>
  </div>

  <div id="countdown"></div>

  <div class="main-card">

    <div class="input-row">
      <input id="taskText" placeholder="Tugas...">
      <select id="taskPriority">
        <option value="low">ğŸŸ¢ Low</option>
        <option value="medium">ğŸŸ¡ Medium</option>
        <option value="high">ğŸ”´ High</option>
      </select>
      <select id="taskReminder">
        <option value="0">No Reminder</option>
        <option value="5">5 menit</option>
        <option value="15" selected>15 menit</option>
        <option value="30">30 menit</option>
      </select>
      <button class="btn" onclick="addTask()">Tambah</button>
    </div>

    <input type="datetime-local" id="taskTime">

    <div id="taskList"></div>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let alarmTimer;

function save(){
  localStorage.setItem("tasks",JSON.stringify(tasks));
}

function toggleDark(){
  document.body.classList.toggle("dark-mode");
}

function playSound(){
  const s=document.getElementById("alarmSound");
  s.currentTime=0;
  s.play().catch(()=>{});
}

function requestNotif(){
  if("Notification"in window){
    Notification.requestPermission();
  }
}

function notify(title,body){
  if(Notification.permission==="granted"){
    new Notification(title,{body});
  }
}

function addTask(){
  const text=taskText.value.trim();
  const time=taskTime.value;
  if(!text||!time)return alert("Lengkapi data");

  tasks.push({
    id:Date.now(),
    text,
    time,
    priority:taskPriority.value,
    reminder:+taskReminder.value,
    completed:false,
    reminded:false,
    alarmed:false
  });

  taskText.value="";
  taskTime.value="";
  save();
  render();
}

function toggleTask(id){
  const t=tasks.find(x=>x.id===id);
  t.completed=!t.completed;
  save();
  render();
}

function delTask(id){
  if(confirm("Hapus tugas?")){
    tasks=tasks.filter(x=>x.id!==id);
    save();render();
  }
}

function render(){
  const list=document.getElementById("taskList");
  list.innerHTML="";
  const now=new Date();

  tasks.forEach(t=>{
    const dt=new Date(t.time);
    const div=document.createElement("div");
    div.className="task";
    if(t.completed)div.classList.add("completed");
    if(dt<now&&!t.completed)div.classList.add("overdue");
    if(dt-now<3600000&&dt>now)div.classList.add("upcoming");

    div.innerHTML=`
      <input type="checkbox" ${t.completed?"checked":""} onchange="toggleTask(${t.id})">
      <div>
        <b>${t.text}</b><br>
        â° ${dt.toLocaleString()} | ${t.priority.toUpperCase()}
      </div>
      <div class="actions">
        <button onclick="delTask(${t.id})">ğŸ—‘ï¸</button>
      </div>`;
    list.appendChild(div);
  });

  updateCountdown();
}

function updateCountdown(){
  const box=document.getElementById("countdown");
  const now=new Date();
  const upcoming=tasks
    .filter(t=>!t.completed)
    .map(t=>new Date(t.time))
    .filter(d=>d>now)
    .sort((a,b)=>a-b)[0];

  if(!upcoming){box.innerHTML="";return;}

  const diff=upcoming-now;
  box.innerHTML=`â³ Jadwal terdekat dalam ${Math.floor(diff/60000)} menit`;
}

function startAlarm(){
  alarmTimer=setInterval(()=>{
    const now=new Date();
    tasks.forEach(t=>{
      if(t.completed)return;
      const dt=new Date(t.time);
      const rem=new Date(dt.getTime()-t.reminder*60000);

      if(!t.reminded && t.reminder>0 && now>=rem && now<dt){
        notify("â° Reminder",`${t.text}`);
        playSound();
        t.reminded=true; save();
      }

      if(!t.alarmed && now>=dt && now-dt<60000){
        notify("ğŸš¨ Alarm",`${t.text}`);
        playSound();
        t.alarmed=true; save();
      }
    });
  },10000);
}

render();
startAlarm();
</script>
</body>
</html>
